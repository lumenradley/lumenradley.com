---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const postPath = (post: (typeof posts)[number]) => `/blog/${(post.slug ?? post.id).replace(/\.md$/, "")}/`;

const formatDate = (date: Date) =>
  new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric"
  }).format(date);
---

<BaseLayout title="Blog | Lumen Radley" description="All posts.">
  <h2 class="section-title">All Posts</h2>
  <div class="list">
    {
      posts.map((post) => (
        <article class="card">
          <h3>
            <a href={postPath(post)}>{post.data.title}</a>
          </h3>
          <p>{post.data.description}</p>
          <div class="meta">{formatDate(post.data.pubDate)}</div>
        </article>
      ))
    }
  </div>
</BaseLayout>
